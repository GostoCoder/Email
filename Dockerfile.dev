# =============================================================================
# Dockerfile.dev pour Outil-Emailing (Développement avec Hot-Reload)
# Architecture MVVM Feature-First
# =============================================================================

FROM python:3.11-slim

WORKDIR /app

# Métadonnées
LABEL maintainer="Almadia Solutions"
LABEL description="Outil Emailing - Development Environment"

# Installer Node.js et les outils de développement
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl \
    gcc \
    git \
    && curl -fsSL https://deb.nodesource.com/setup_18.x | bash - \
    && apt-get install -y nodejs \
    && rm -rf /var/lib/apt/lists/* \
    && apt-get clean

# Copier les fichiers de dépendances
COPY requirements.txt package*.json ./

# Installer les dépendances Python et Node.js
RUN pip install --no-cache-dir -r requirements.txt \
    && pip install --no-cache-dir watchdog[watchmedo] \
    && npm ci

# Copier les fichiers de configuration
COPY tsconfig*.json vite.config.ts ./

# Créer les répertoires pour les données
RUN mkdir -p /app/data/uploads /app/data/logs

# Exposer les ports (Flask + Vite)
EXPOSE 5000 3000

# Variables d'environnement pour le développement
ENV FLASK_ENV=development \
    FLASK_DEBUG=1 \
    PYTHONUNBUFFERED=1 \
    VITE_API_URL=http://localhost:5000/api

# Script de démarrage pour lancer backend et frontend en parallèle
# Le code source sera monté via volumes dans docker-compose
CMD ["sh", "-c", "npm run dev & python -m app.main"]
